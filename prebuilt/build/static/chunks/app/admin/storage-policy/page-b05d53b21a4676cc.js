(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[671],{1689:function(e,t,r){Promise.resolve().then(r.bind(r,1314))},1314:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return StoragePolicyPage}});var n=r(5667),s=r(2026),a=r(8712),i=r(8260),l=r(2078),d=r(8291),c=r(4757),o=r(1017),u=r(2353),f=r.n(u),m=r(994),g=r(6889);let x=m.fC,h=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)(m.aV,{ref:t,className:(0,g.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",r),...s})});h.displayName=m.aV.displayName;let b=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)(m.xz,{ref:t,className:(0,g.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",r),...s})});b.displayName=m.xz.displayName;let v=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)(m.VY,{ref:t,className:(0,g.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),...s})});function StoragePolicyPage(){let[e,t]=(0,s.useState)(!1),[r,u]=(0,s.useState)(!1),[m,g]=(0,s.useState)(null),[p,j]=(0,s.useState)(null),N="-- Allow public access to the images bucket\nCREATE POLICY \"Public Access\" ON storage.objects\n  FOR SELECT\n  USING (bucket_id = 'images');\n\n-- Allow authenticated users to upload files to the images bucket\nCREATE POLICY \"Authenticated users can upload\" ON storage.objects\n  FOR INSERT\n  WITH CHECK (\n    bucket_id = 'images' AND\n    auth.role() = 'authenticated'\n  );\n\n-- Allow authenticated users to update their own files\nCREATE POLICY \"Authenticated users can update their own files\" ON storage.objects\n  FOR UPDATE\n  USING (\n    bucket_id = 'images' AND\n    auth.uid() = owner\n  );\n\n-- Allow authenticated users to delete their own files\nCREATE POLICY \"Authenticated users can delete their own files\" ON storage.objects\n  FOR DELETE\n  USING (\n    bucket_id = 'images' AND\n    auth.uid() = owner\n  );",updatePolicy=async()=>{t(!0),u(!1),g(null),j(null);try{let e=await fetch("/api/storage-policy",{method:"POST"}),t=await e.json();if(!e.ok)throw (t.details&&j(t.details), Error(t.error||"حدث خطأ أثناء تحديث سياسة التخزين"));u(!0)}catch(e){g(e.message||"حدث خطأ أثناء تحديث سياسة التخزين")}finally{t(!1)}};return(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold",children:"إدارة سياسة التخزين"}),(0,n.jsx)(f(),{href:"/admin",children:(0,n.jsx)(a.z,{variant:"outline",children:"العودة إلى لوحة التحكم"})})]}),(0,n.jsxs)(i.Zb,{children:[(0,n.jsxs)(i.Ol,{children:[(0,n.jsx)(i.ll,{children:"تحديث سياسة التخزين"}),(0,n.jsx)(i.SZ,{children:"استخدم هذه الصفحة لتحديث سياسة التخزين للسماح برفع الصور"})]}),(0,n.jsx)(i.aY,{children:(0,n.jsxs)(x,{defaultValue:"automatic",children:[(0,n.jsxs)(h,{className:"mb-4",children:[(0,n.jsx)(b,{value:"automatic",children:"تحديث تلقائي"}),(0,n.jsx)(b,{value:"manual",children:"تحديث يدوي"})]}),(0,n.jsxs)(v,{value:"automatic",children:[(0,n.jsx)("p",{className:"mb-4",children:"إذا كنت تواجه مشكلة في رفع الصور مع رسالة خطأ تتعلق بسياسة الأمان (RLS)، يمكنك النقر على الزر أدناه لتحديث سياسة التخزين."}),m&&(0,n.jsxs)(l.bZ,{variant:"destructive",className:"mb-4",children:[(0,n.jsx)(d.Z,{className:"h-4 w-4"}),(0,n.jsx)(l.Cd,{children:"خطأ"}),(0,n.jsx)(l.X,{children:m})]}),r&&(0,n.jsxs)(l.bZ,{className:"mb-4 bg-green-50 text-green-800 border-green-200",children:[(0,n.jsx)(c.Z,{className:"h-4 w-4 text-green-600"}),(0,n.jsx)(l.Cd,{children:"تم بنجاح"}),(0,n.jsx)(l.X,{children:"تم تحديث سياسة التخزين بنجاح. يمكنك الآن رفع الصور."})]}),(0,n.jsx)(a.z,{onClick:updatePolicy,disabled:e,className:"mb-4",children:e?"جاري التحديث...":"تحديث سياسة التخزين"}),p&&(0,n.jsx)("div",{className:"mt-4",children:(0,n.jsx)("p",{className:"text-red-600 mb-2",children:"فشل التحديث التلقائي. يرجى استخدام التحديث اليدوي."})})]}),(0,n.jsxs)(v,{value:"manual",children:[(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("p",{className:"mb-4",children:"إذا فشل التحديث التلقائي، يمكنك تحديث سياسة التخزين يدويًا باتباع الخطوات التالية:"}),(0,n.jsxs)("ol",{className:"list-decimal list-inside space-y-2 mb-4",children:[(0,n.jsx)("li",{children:"انسخ النص البرمجي SQL أدناه"}),(0,n.jsx)("li",{children:"انتقل إلى لوحة تحكم Supabase"}),(0,n.jsx)("li",{children:"اذهب إلى قسم SQL Editor"}),(0,n.jsx)("li",{children:"الصق النص البرمجي وقم بتنفيذه"})]})]}),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("pre",{className:"bg-gray-900 text-gray-100 p-4 rounded-md overflow-x-auto text-sm mb-4 max-h-80 overflow-y-auto",children:(0,n.jsx)("code",{children:N})}),(0,n.jsx)(a.z,{variant:"outline",size:"icon",className:"absolute top-2 right-2 h-8 w-8 bg-gray-800 border-gray-700 hover:bg-gray-700",onClick:()=>{navigator.clipboard.writeText(N)},children:(0,n.jsx)(o.Z,{className:"h-4 w-4 text-gray-400"})})]}),(0,n.jsx)("p",{className:"text-sm text-gray-500",children:"هذا النص البرمجي سيقوم بإنشاء سياسات RLS تسمح للمستخدمين المصادق عليهم برفع الصور إلى مجلد التخزين."})]})]})})]})]})}v.displayName=m.VY.displayName},2078:function(e,t,r){"use strict";r.d(t,{Cd:function(){return c},X:function(){return o},bZ:function(){return d}});var n=r(5667),s=r(2026),a=r(1057),i=r(6889);let l=(0,a.j)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),d=s.forwardRef((e,t)=>{let{className:r,variant:s,...a}=e;return(0,n.jsx)("div",{ref:t,role:"alert",className:(0,i.cn)(l({variant:s}),r),...a})});d.displayName="Alert";let c=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("h5",{ref:t,className:(0,i.cn)("mb-1 font-medium leading-none tracking-tight",r),...s})});c.displayName="AlertTitle";let o=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:(0,i.cn)("text-sm [&_p]:leading-relaxed",r),...s})});o.displayName="AlertDescription"},8712:function(e,t,r){"use strict";r.d(t,{d:function(){return d},z:function(){return c}});var n=r(5667),s=r(2026),a=r(8862),i=r(1057),l=r(6889);let d=(0,i.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=s.forwardRef((e,t)=>{let{className:r,variant:s,size:i,asChild:c=!1,...o}=e,u=c?a.g7:"button";return(0,n.jsx)(u,{className:(0,l.cn)(d({variant:s,size:i,className:r})),ref:t,...o})});c.displayName="Button"},8260:function(e,t,r){"use strict";r.d(t,{Ol:function(){return l},SZ:function(){return c},Zb:function(){return i},aY:function(){return o},eW:function(){return u},ll:function(){return d}});var n=r(5667),s=r(2026),a=r(6889);let i=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...s})});i.displayName="Card";let l=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",r),...s})});l.displayName="CardHeader";let d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("text-2xl font-semibold leading-none tracking-tight",r),...s})});d.displayName="CardTitle";let c=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("text-sm text-muted-foreground",r),...s})});c.displayName="CardDescription";let o=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("p-6 pt-0",r),...s})});o.displayName="CardContent";let u=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("flex items-center p-6 pt-0",r),...s})});u.displayName="CardFooter"},6889:function(e,t,r){"use strict";r.d(t,{cn:function(){return cn}});var n=r(2856),s=r(7660);function cn(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.m6)((0,n.W)(t))}}},function(e){e.O(0,[617,618,40,505,262,744],function(){return e(e.s=1689)}),_N_E=e.O()}]);