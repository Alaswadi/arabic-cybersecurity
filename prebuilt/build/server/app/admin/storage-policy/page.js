(()=>{var e={};e.id=9671,e.ids=[9671],e.modules={55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},25528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},41808:e=>{"use strict";e.exports=require("net")},85477:e=>{"use strict";e.exports=require("punycode")},12781:e=>{"use strict";e.exports=require("stream")},24404:e=>{"use strict";e.exports=require("tls")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},47247:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>d,routeModule:()=>p,tree:()=>l});var r=s(35758),a=s(83263),i=s(81307),n=s.n(i),c=s(55837),o={};for(let e in c)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>c[e]);s.d(t,o);let l=["",{children:["admin",{children:["storage-policy",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,31657)),"C:\\Users\\fadia\\Documents\\augment-projects\\arabic-cybersecurity\\app\\admin\\storage-policy\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,15801)),"C:\\Users\\fadia\\Documents\\augment-projects\\arabic-cybersecurity\\app\\admin\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.bind(s,55831)),"C:\\Users\\fadia\\Documents\\augment-projects\\arabic-cybersecurity\\app\\admin\\not-found.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,88910)),"C:\\Users\\fadia\\Documents\\augment-projects\\arabic-cybersecurity\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,84219,23)),"next/dist/client/components/not-found-error"]}],d=["C:\\Users\\fadia\\Documents\\augment-projects\\arabic-cybersecurity\\app\\admin\\storage-policy\\page.tsx"],u="/admin/storage-policy/page",m={require:s,loadChunk:()=>Promise.resolve()},p=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/admin/storage-policy/page",pathname:"/admin/storage-policy",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},65e3:(e,t,s)=>{Promise.resolve().then(s.bind(s,60923))},60923:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>StoragePolicyPage});var r=s(67622),a=s(50789),i=s(2877),n=s(38307),c=s(94408),o=s(62511),l=s(20664),d=s(31879),u=s(36698),m=s.n(u),p=s(47661),x=s(54155);let h=p.fC,g=a.forwardRef(({className:e,...t},s)=>r.jsx(p.aV,{ref:s,className:(0,x.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...t}));g.displayName=p.aV.displayName;let b=a.forwardRef(({className:e,...t},s)=>r.jsx(p.xz,{ref:s,className:(0,x.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...t}));b.displayName=p.xz.displayName;let f=a.forwardRef(({className:e,...t},s)=>r.jsx(p.VY,{ref:s,className:(0,x.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));function StoragePolicyPage(){let[e,t]=(0,a.useState)(!1),[s,u]=(0,a.useState)(!1),[p,x]=(0,a.useState)(null),[j,y]=(0,a.useState)(null),v=`-- Allow public access to the images bucket
CREATE POLICY "Public Access" ON storage.objects
  FOR SELECT
  USING (bucket_id = 'images');

-- Allow authenticated users to upload files to the images bucket
CREATE POLICY "Authenticated users can upload" ON storage.objects
  FOR INSERT
  WITH CHECK (
    bucket_id = 'images' AND
    auth.role() = 'authenticated'
  );

-- Allow authenticated users to update their own files
CREATE POLICY "Authenticated users can update their own files" ON storage.objects
  FOR UPDATE
  USING (
    bucket_id = 'images' AND
    auth.uid() = owner
  );

-- Allow authenticated users to delete their own files
CREATE POLICY "Authenticated users can delete their own files" ON storage.objects
  FOR DELETE
  USING (
    bucket_id = 'images' AND
    auth.uid() = owner
  );`,updatePolicy=async()=>{t(!0),u(!1),x(null),y(null);try{let e=await fetch("/api/storage-policy",{method:"POST"}),t=await e.json();if(!e.ok)throw (t.details&&y(t.details), Error(t.error||"حدث خطأ أثناء تحديث سياسة التخزين"));u(!0)}catch(e){x(e.message||"حدث خطأ أثناء تحديث سياسة التخزين")}finally{t(!1)}};return(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[r.jsx("h1",{className:"text-3xl font-bold",children:"إدارة سياسة التخزين"}),r.jsx(m(),{href:"/admin",children:r.jsx(i.z,{variant:"outline",children:"العودة إلى لوحة التحكم"})})]}),(0,r.jsxs)(n.Zb,{children:[(0,r.jsxs)(n.Ol,{children:[r.jsx(n.ll,{children:"تحديث سياسة التخزين"}),r.jsx(n.SZ,{children:"استخدم هذه الصفحة لتحديث سياسة التخزين للسماح برفع الصور"})]}),r.jsx(n.aY,{children:(0,r.jsxs)(h,{defaultValue:"automatic",children:[(0,r.jsxs)(g,{className:"mb-4",children:[r.jsx(b,{value:"automatic",children:"تحديث تلقائي"}),r.jsx(b,{value:"manual",children:"تحديث يدوي"})]}),(0,r.jsxs)(f,{value:"automatic",children:[r.jsx("p",{className:"mb-4",children:"إذا كنت تواجه مشكلة في رفع الصور مع رسالة خطأ تتعلق بسياسة الأمان (RLS)، يمكنك النقر على الزر أدناه لتحديث سياسة التخزين."}),p&&(0,r.jsxs)(c.bZ,{variant:"destructive",className:"mb-4",children:[r.jsx(o.Z,{className:"h-4 w-4"}),r.jsx(c.Cd,{children:"خطأ"}),r.jsx(c.X,{children:p})]}),s&&(0,r.jsxs)(c.bZ,{className:"mb-4 bg-green-50 text-green-800 border-green-200",children:[r.jsx(l.Z,{className:"h-4 w-4 text-green-600"}),r.jsx(c.Cd,{children:"تم بنجاح"}),r.jsx(c.X,{children:"تم تحديث سياسة التخزين بنجاح. يمكنك الآن رفع الصور."})]}),r.jsx(i.z,{onClick:updatePolicy,disabled:e,className:"mb-4",children:e?"جاري التحديث...":"تحديث سياسة التخزين"}),j&&r.jsx("div",{className:"mt-4",children:r.jsx("p",{className:"text-red-600 mb-2",children:"فشل التحديث التلقائي. يرجى استخدام التحديث اليدوي."})})]}),(0,r.jsxs)(f,{value:"manual",children:[(0,r.jsxs)("div",{className:"mb-4",children:[r.jsx("p",{className:"mb-4",children:"إذا فشل التحديث التلقائي، يمكنك تحديث سياسة التخزين يدويًا باتباع الخطوات التالية:"}),(0,r.jsxs)("ol",{className:"list-decimal list-inside space-y-2 mb-4",children:[r.jsx("li",{children:"انسخ النص البرمجي SQL أدناه"}),r.jsx("li",{children:"انتقل إلى لوحة تحكم Supabase"}),r.jsx("li",{children:"اذهب إلى قسم SQL Editor"}),r.jsx("li",{children:"الصق النص البرمجي وقم بتنفيذه"})]})]}),(0,r.jsxs)("div",{className:"relative",children:[r.jsx("pre",{className:"bg-gray-900 text-gray-100 p-4 rounded-md overflow-x-auto text-sm mb-4 max-h-80 overflow-y-auto",children:r.jsx("code",{children:v})}),r.jsx(i.z,{variant:"outline",size:"icon",className:"absolute top-2 right-2 h-8 w-8 bg-gray-800 border-gray-700 hover:bg-gray-700",onClick:()=>{navigator.clipboard.writeText(v)},children:r.jsx(d.Z,{className:"h-4 w-4 text-gray-400"})})]}),r.jsx("p",{className:"text-sm text-gray-500",children:"هذا النص البرمجي سيقوم بإنشاء سياسات RLS تسمح للمستخدمين المصادق عليهم برفع الصور إلى مجلد التخزين."})]})]})})]})]})}f.displayName=p.VY.displayName},31657:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>n,__esModule:()=>i,default:()=>o});var r=s(89408);let a=(0,r.createProxy)(String.raw`C:\Users\fadia\Documents\augment-projects\arabic-cybersecurity\app\admin\storage-policy\page.tsx`),{__esModule:i,$$typeof:n}=a,c=a.default,o=c}};var t=require("../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),s=t.X(0,[9010,6342,329,1031,895,3433,4306,6257,3515,4140,6972,8929,5712,7615,5324,8307,4408],()=>__webpack_exec__(47247));module.exports=s})();